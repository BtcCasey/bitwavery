<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC SINGULARITY v2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; transition: background 1.5s; }
        #ui {
            position: absolute; top: 25px; left: 25px; z-index: 100;
            background: rgba(0,0,0,0.9); padding: 18px; border: 2px solid #5e43f3;
            box-shadow: 0 0 20px rgba(94, 67, 243, 0.4);
        }
        .label { font-size: 8px; color: #5e43f3; margin-bottom: 8px; letter-spacing: 1px; }
        #price { font-size: 18px; color: #fff; margin: 0; text-shadow: 2px 2px #000; }
        #event-log { position: absolute; bottom: 20px; left: 20px; font-size: 7px; color: #00ffcc; line-height: 1.6; pointer-events: none; text-transform: uppercase; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="ui">
    <div class="label">UNIVERSAL SIGNAL: BTC/USD</div>
    <h1 id="price">SYNCING...</h1>
</div>

<div id="event-log"></div>
<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const logDisplay = document.getElementById('event-log');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    let targetPrice = 0, currentPrice = 0, priceDirection = 0;
    let minutePriceHistory = []; // For Supernova detection
    let supernovaAlpha = 0;
    let effects = [];
    let trail = [];
    let bgStars = Array.from({length: 100}, () => ({ 
        x: Math.random()*RES_W, y: Math.random()*RES_H, 
        s: Math.random()*1.5, v: 0.1 + Math.random()*0.3 
    }));

    function logEvent(msg) {
        const div = document.createElement('div');
        div.innerText = `> ${msg}`;
        logDisplay.prepend(div);
        if(logDisplay.children.length > 6) logDisplay.lastChild.remove();
    }

    // --- EFFECT CLASSES ---
    class PulsarWave { constructor() { this.r = 10; this.life = 1.0; } update() { this.r += 3.5; this.life -= 0.02; } draw() { ctx.strokeStyle = `rgba(255,255,255,${this.life})`; ctx.beginPath(); ctx.arc(RES_W/2, RES_H/2, this.r, 0, Math.PI*2); ctx.stroke(); } }
    class Spaceship { constructor() { this.x = -50; this.y = RES_H/2 + (Math.random()*100-50); this.v = 2.8; } update() { this.x += this.v; } draw() { ctx.fillStyle = "#aaa"; ctx.fillRect(this.x, this.y, 14, 4); ctx.fillStyle = "#0cf"; ctx.fillRect(this.x+10, this.y+1, 3, 2); } }
    class UFO { constructor() { this.x = RES_W+50; this.y = 70; this.v = -1.5; this.t = 0; } update() { this.x += this.v; this.t += 0.08; } draw() { const dy = Math.sin(this.t)*20; ctx.fillStyle = "#0f0"; ctx.fillRect(this.x, this.y+dy, 18, 5); ctx.fillStyle = "#fff"; ctx.fillRect(this.x+6, this.y-3+dy, 6, 3); } }
    class BlackHole { constructor() { this.r = 0; this.life = 120; } update() { this.r = Math.min(60, this.r + 4); this.life--; } draw() { ctx.fillStyle = `rgba(0,0,0,${this.life/120})`; ctx.beginPath(); ctx.arc(RES_W/2, RES_H/2, this.r, 0, Math.PI*2); ctx.fill(); ctx.strokeStyle = "#ff00ff"; ctx.stroke(); } }

    // --- LOGIC & DATA ---
    function init() {
        const ws = new WebSocket('wss://api-pub.bitfinex.com/ws/2');
        ws.onopen = () => {
            ws.send(JSON.stringify({ event: 'subscribe', channel: 'ticker', symbol: 'tBTCUSD' }));
            ws.send(JSON.stringify({ event: 'subscribe', channel: 'trades', symbol: 'tBTCUSD' }));
        };
        ws.onmessage = (msg) => {
            const data = JSON.parse(msg.data);
            if (!Array.isArray(data)) return;

            // Handle Price Ticker
            if (data[1] && Array.isArray(data[1]) && data[1].length > 6) {
                const newPrice = data[1][6];
                if (targetPrice > 0) {
                    priceDirection = newPrice >= targetPrice ? 1 : -1;
                    checkMilestones(newPrice, targetPrice);
                    detectSupernova(newPrice);
                }
                targetPrice = newPrice;
                priceDisplay.innerText = `$${Math.floor(targetPrice).toLocaleString()}`;
            }

            // Handle Trades (Whale Detection)
            if (data[1] === "te") {
                const usdValue = Math.abs(data[2][2] * data[2][3]);
                if (usdValue >= 10000) {
                    effects.push(new BlackHole());
                    logEvent(`WHALE DETECTED: $${Math.floor(usdValue).toLocaleString()}`);
                }
            }
        };
    }

    function checkMilestones(p, oldP) {
        if (Math.floor(p/100) !== Math.floor(oldP/100)) { effects.push(new PulsarWave()); logEvent("$100 BARRIER CROSS"); }
        if (Math.floor(p/500) !== Math.floor(oldP/500)) { effects.push(new Spaceship()); logEvent("NAVIGATOR SCANNING ($500)"); }
        if (Math.floor(p/1000) !== Math.floor(oldP/1000)) { effects.push(new UFO()); logEvent("UFO SIGNAL: $1000 MILESTONE"); }
    }

    function detectSupernova(p) {
        const now = Date.now();
        minutePriceHistory.push({ t: now, p: p });
        minutePriceHistory = minutePriceHistory.filter(h => now - h.t < 60000);
        
        if (minutePriceHistory.length > 2) {
            const oldP = minutePriceHistory[0].p;
            const change = Math.abs((p - oldP) / oldP);
            if (change >= 0.02) { // 2% Change in 1 Minute
                supernovaAlpha = 1.0;
                logEvent("CRITICAL ALERT: SUPERNOVA EVENT DETECTED");
            }
        }
    }

    function render(time) {
        // Chameleon Background
        let baseBG = priceDirection === 1 ? "#021205" : (priceDirection === -1 ? "#120202" : "#010208");
        ctx.fillStyle = baseBG; ctx.fillRect(0, 0, RES_W, RES_H);

        // Dynamic Stars
        bgStars.forEach(s => {
            s.x = (s.x - s.v + RES_W) % RES_W;
            ctx.fillStyle = priceDirection === 1 ? "#00ff88" : (priceDirection === -1 ? "#ff4444" : "#ffffff");
            ctx.fillRect(Math.floor(s.x), Math.floor(s.y), s.s, s.s);
        });

        currentPrice += (targetPrice - currentPrice) * 0.05;

        // Comet Tail (Volume/Velocity)
        trail.push({x: RES_W/2, y: RES_H/2 + (Math.sin(time/400)*20)});
        if (trail.length > 40) trail.shift();
        trail.forEach((p, i) => {
            ctx.strokeStyle = priceDirection === 1 ? `rgba(0, 255, 136, ${i/trail.length})` : `rgba(255, 68, 68, ${i/trail.length})`;
            ctx.beginPath(); ctx.arc(p.x - (trail.length - i)*2.5, p.y, i/3, 0, Math.PI*2); ctx.stroke();
        });

        // The Core
        const pulse = 25 + Math.sin(time/200)*6;
        const g = ctx.createRadialGradient(RES_W/2, RES_H/2, 2, RES_W/2, RES_H/2, pulse*1.8);
        g.addColorStop(0, "#fff");
        g.addColorStop(0.4, priceDirection === 1 ? "#00ff88" : (priceDirection === -1 ? "#ff4444" : "#5e43f3"));
        g.addColorStop(1, "transparent");
        ctx.fillStyle = g; ctx.fillRect(RES_W/2-70, RES_H/2-70, 140, 140);

        // Render Effects
        effects = effects.filter(e => {
            e.update(); e.draw();
            return (e.life === undefined || e.life > 0) && (e.x === undefined || (e.x > -60 && e.x < RES_W+60));
        });

        // Supernova Flash Overlay
        if (supernovaAlpha > 0) {
            ctx.fillStyle = `rgba(255, 255, 255, ${supernovaAlpha})`;
            ctx.fillRect(0, 0, RES_W, RES_H);
            supernovaAlpha -= 0.01;
        }

        // CRT Scanline Overlay
        if (Math.floor(time/40) % 2 === 0) {
            ctx.fillStyle = "rgba(255, 255, 255, 0.03)";
            for(let i=0; i<RES_H; i+=2) ctx.fillRect(0, i, RES_W, 1);
        }

        requestAnimationFrame(render);
    }

    init(); render();
</script>
</body>
</html>
