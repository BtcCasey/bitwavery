<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BTC COMMAND: SOVEREIGN CORE</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; }
        #ui-main { position: absolute; top: 25px; left: 25px; z-index: 100; background: rgba(0,0,0,0.95); padding: 18px; border: 2px solid #fff; pointer-events: none; }
        #view-toggle { position: absolute; top: 25px; right: 25px; z-index: 100; background: #fff; color: #000; border: 2px solid #000; padding: 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 10px; }
        #price { font-size: 18px; color: #fff; margin: 0; }
        #status { font-size: 7px; margin-top: 10px; color: #aaa; text-transform: uppercase; }
        canvas { display: block; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<button id="view-toggle">TO BATTLEFIELD</button>
<div id="ui-main">
    <div id="view-label" style="font-size: 8px; color: #fff; margin-bottom: 8px;">COSMOS STATUS: SYNCED</div>
    <h1 id="price">...</h1>
    <div id="status">SCANNING DEEP SPACE...</div>
</div>
<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const statusDisplay = document.getElementById('status');
    const viewToggle = document.getElementById('view-toggle');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    // --- STATE ---
    let currentView = 'singularity';
    let btcPrice = 0, startDayPrice = 0, currentVol = 0;
    let ships = []; // {x, y, side, vol, life}
    let stars = Array.from({length: 60}, () => ({ x: Math.random()*RES_W, y: Math.random()*RES_H, v: 0.05+Math.random()*0.1 }));

    // --- DATA ENGINE ---
    function init() {
        const ws = new WebSocket('wss://ws-feed.exchange.coinbase.com');
        ws.onopen = () => {
            ws.send(JSON.stringify({
                type: "subscribe",
                channels: ["ticker", "matches"],
                product_ids: ["BTC-USD"]
            }));
            // Get 24h open price for star color
            fetch('https://api.exchange.coinbase.com/products/BTC-USD/stats')
                .then(r => r.json()).then(d => startDayPrice = parseFloat(d.open));
        };

        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if (data.type === 'ticker') {
                btcPrice = parseFloat(data.price);
                currentVol = parseFloat(data.volume_24h);
                priceDisplay.innerText = `$${btcPrice.toLocaleString()}`;
                statusDisplay.innerText = `VOL: ${Math.floor(currentVol).toLocaleString()} BTC`;
            }
            if (data.type === 'match' && currentView === 'radar') {
                ships.push({
                    x: Math.random() * RES_W,
                    y: data.side === 'buy' ? RES_H + 20 : -20,
                    side: data.side,
                    vol: parseFloat(data.size),
                    v: 1 + Math.random() * 2
                });
            }
        };
    }

    viewToggle.onclick = () => {
        currentView = currentView === 'singularity' ? 'radar' : 'singularity';
        viewToggle.innerText = currentView === 'singularity' ? 'TO BATTLEFIELD' : 'TO CORE';
    };

    function drawSaturn(time) {
        const cx = RES_W/2, cy = RES_H/2;
        const volSpeed = 1 + (currentVol / 10000); // Speed scale
        
        // --- THE RINGS (BACK PART) ---
        ctx.strokeStyle = "rgba(255,255,255,0.4)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.ellipse(cx, cy, 60, 20, Math.PI/8 + Math.sin(time/2000)*0.1, Math.PI, 0);
        ctx.stroke();

        // --- THE WHITE CORE ---
        const pulse = 25 + Math.sin(time/200)*3;
        const g = ctx.createRadialGradient(cx, cy, 5, cx, cy, pulse);
        g.addColorStop(0, "#fff");
        g.addColorStop(1, "rgba(255,255,255,0)");
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(cx, cy, pulse, 0, Math.PI*2); ctx.fill();

        // --- THE RINGS (FRONT PART) ---
        ctx.beginPath();
        ctx.ellipse(cx, cy, 60, 20, Math.PI/8 + Math.sin(time/2000)*0.1, 0, Math.PI);
        ctx.stroke();
    }

    function render(time) {
        ctx.fillStyle = "#010208";
        ctx.fillRect(0, 0, RES_W, RES_H);

        // --- SENTIMENT STARS ---
        const starColor = btcPrice >= startDayPrice ? "#00ff88" : "#ff4444";
        stars.forEach(s => {
            s.x = (s.x - s.v + RES_W) % RES_W;
            ctx.fillStyle = starColor;
            ctx.globalAlpha = 0.3 + Math.sin(time/500 + s.x)*0.2;
            ctx.fillRect(Math.floor(s.x), Math.floor(s.y), 1, 1);
        });
        ctx.globalAlpha = 1;

        if (btcPrice === 0) return requestAnimationFrame(render);

        if (currentView === 'singularity') {
            drawSaturn(time);
        } else {
            // --- BATTLEFIELD SHIPS ---
            ships = ships.filter(s => {
                ctx.fillStyle = s.side === 'buy' ? "#00ff88" : "#ff4444";
                const size = 2 + Math.min(8, s.vol * 100);
                
                // Draw 8-bit ship
                ctx.fillRect(s.x, s.y, size, size);
                ctx.fillRect(s.x + (size/4), s.side === 'buy' ? s.y+size : s.y-size/2, size/2, size/2);

                s.y += s.side === 'buy' ? -s.v : s.v;
                return s.y > -50 && s.y < RES_H + 50;
            });
        }

        requestAnimationFrame(render);
    }

    init();
    render();
</script>
</body>
</html>
