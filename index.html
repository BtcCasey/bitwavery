<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BTC NAVIGATOR: UNIFIED</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; }
        
        #ui-main { position: absolute; top: 25px; left: 25px; z-index: 100; background: rgba(0,0,0,0.9); padding: 18px; border: 2px solid #5e43f3; }
        #view-toggle { 
            position: absolute; top: 25px; right: 25px; z-index: 100; 
            background: #5e43f3; color: #fff; border: 4px solid #fff; 
            padding: 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 10px;
        }
        #price { font-size: 18px; color: #fff; margin: 0; }
        #status { font-size: 7px; margin-top: 10px; color: #00ffcc; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<button id="view-toggle">GO TO RADAR</button>

<div id="ui-main">
    <div id="view-label" style="font-size: 8px; color: #5e43f3; margin-bottom: 8px;">CORE: SINGULARITY</div>
    <h1 id="price">CONNECTING...</h1>
    <div id="status">SCANNING FREQUENCIES...</div>
</div>

<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const statusDisplay = document.getElementById('status');
    const viewToggle = document.getElementById('view-toggle');
    const viewLabel = document.getElementById('view-label');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    let currentView = 'singularity';
    let btcPrice = 0, lerpPrice = 0;
    let asks = [], bids = [];
    let stars = Array.from({length: 50}, () => ({ x: Math.random()*RES_W, y: Math.random()*RES_H, v: 0.2+Math.random()*0.5 }));

    // --- UNIFIED BINANCE STREAM ---
    function initStream() {
        // Combined Stream: Ticker + Top 20 Depth
        const ws = new WebSocket('wss://stream.binance.com:9443/stream?streams=btcusdt@ticker/btcusdt@depth20@100ms');

        ws.onopen = () => { statusDisplay.innerText = "SIGNAL ACQUIRED"; };

        ws.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            
            // Handle Price Ticker
            if (msg.stream === 'btcusdt@ticker') {
                btcPrice = parseFloat(msg.data.c);
                priceDisplay.innerText = `$${Math.floor(btcPrice).toLocaleString()}`;
            }

            // Handle Order Book
            if (msg.stream === 'btcusdt@depth20@100ms') {
                asks = msg.data.asks.slice(0, 10);
                bids = msg.data.bids.slice(0, 10);
            }
        };

        ws.onclose = () => {
            statusDisplay.innerText = "RECONNECTING...";
            setTimeout(initStream, 2000);
        };
    }

    viewToggle.onclick = () => {
        currentView = currentView === 'singularity' ? 'radar' : 'singularity';
        viewToggle.innerText = currentView === 'singularity' ? 'GO TO RADAR' : 'GO TO SINGULARITY';
        viewLabel.innerText = currentView === 'singularity' ? 'CORE: SINGULARITY' : 'CORE: DEPTH RADAR';
    };

    function render(time) {
        ctx.fillStyle = "#010208";
        ctx.fillRect(0, 0, RES_W, RES_H);

        // Background
        ctx.fillStyle = "#222";
        stars.forEach(s => {
            s.x = (s.x - s.v + RES_W) % RES_W;
            ctx.fillRect(Math.floor(s.x), Math.floor(s.y), 1, 1);
        });

        if (currentView === 'singularity') {
            // --- SINGULARITY DRAW ---
            const centerX = RES_W / 2;
            const centerY = RES_H / 2;
            const pulse = 25 + Math.sin(time / 200) * 5;

            const grad = ctx.createRadialGradient(centerX, centerY, 2, centerX, centerY, pulse * 2);
            grad.addColorStop(0, "#fff");
            grad.addColorStop(0.3, "#5e43f3");
            grad.addColorStop(1, "transparent");

            ctx.fillStyle = grad;
            ctx.fillRect(centerX - 100, centerY - 100, 200, 200);

            // Orbitals
            for(let i=0; i<8; i++) {
                const ang = (time/1000) + (i * Math.PI/4);
                const x = centerX + Math.cos(ang) * 60;
                const y = centerY + Math.sin(ang) * 40;
                ctx.fillStyle = "#00ffcc";
                ctx.fillRect(x, y, 2, 2);
            }
        } else {
            // --- RADAR DRAW ---
            const centerH = RES_H / 2;
            
            // Drawing Asks (Aliens)
            asks.forEach((lvl, i) => {
                const vol = parseFloat(lvl[1]);
                const x = (RES_W / 12) * (i + 1);
                const y = centerH - 40 - (i * 5);
                const sz = Math.min(15, 4 + vol * 2);
                
                ctx.fillStyle = "#ff4444";
                ctx.fillRect(x - sz/2, y, sz, sz/2); // Ship Hull
                ctx.fillRect(x - 2, y - 4, 4, 4); // Ship Cockpit
            });

            // Drawing Bids (Tanks)
            bids.forEach((lvl, i) => {
                const vol = parseFloat(lvl[1]);
                const x = (RES_W / 12) * (i + 1);
                const y = centerH + 40 + (i * 5);
                const sz = Math.min(15, 4 + vol * 2);

                ctx.fillStyle = "#00ff88";
                ctx.fillRect(x - sz/2, y, sz, 4); // Tank Base
                ctx.fillRect(x - 1, y - 4, 2, 4); // Tank Turret
            });

            // Spread Line
            ctx.strokeStyle = "rgba(94, 67, 243, 0.4)";
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(30, centerH); ctx.lineTo(RES_W - 30, centerH);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        requestAnimationFrame(render);
    }

    initStream();
    render();
</script>
</body>
</html>
