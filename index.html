<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16-BIT EVENT HORIZON</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; }
        #ui {
            position: absolute; top: 25px; left: 25px; z-index: 100;
            background: rgba(0,0,0,0.9); padding: 18px; border: 2px solid #5e43f3;
        }
        #price { font-size: 16px; color: #fff; margin: 0; }
        #event-log { position: absolute; bottom: 20px; left: 20px; font-size: 8px; color: #00ffcc; line-height: 1.5; pointer-events: none; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 8px; color: #5e43f3; margin-bottom: 8px;">CORE SIGNAL: BITCOIN</div>
    <h1 id="price">SYNCING...</h1>
</div>

<div id="event-log"></div>
<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const logDisplay = document.getElementById('event-log');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    let targetPrice = 0, currentPrice = 0, vol24h = 0;
    let effects = [];
    let trail = []; // For the Comet Tail effect

    function logEvent(msg) {
        const div = document.createElement('div');
        div.innerText = `> ${msg}`;
        logDisplay.prepend(div);
        if(logDisplay.children.length > 5) logDisplay.lastChild.remove();
    }

    // --- EFFECT CLASSES ---
    class PulsarWave {
        constructor() { this.r = 10; this.life = 1.0; }
        update() { this.r += 3; this.life -= 0.02; }
        draw() {
            ctx.strokeStyle = `rgba(255, 255, 255, ${this.life})`;
            ctx.beginPath(); ctx.arc(RES_W/2, RES_H/2, this.r, 0, Math.PI*2); ctx.stroke();
        }
    }

    class Spaceship {
        constructor() { this.x = -40; this.y = RES_H/2 + (Math.random()*60-30); this.v = 2.5; }
        update() { this.x += this.v; }
        draw() {
            ctx.fillStyle = "#888"; ctx.fillRect(this.x, this.y, 12, 4); // Hull
            ctx.fillStyle = "#0af"; ctx.fillRect(this.x+8, this.y+1, 2, 2); // Engine
        }
    }

    class UFO {
        constructor() { this.x = RES_W+40; this.y = 50; this.v = -1.5; this.t = 0; }
        update() { this.x += this.v; this.t += 0.1; }
        draw() {
            const dy = Math.sin(this.t) * 15;
            ctx.fillStyle = "#0f0"; ctx.fillRect(this.x, this.y+dy, 16, 4);
            ctx.fillStyle = "#fff"; ctx.fillRect(this.x+5, this.y-3+dy, 6, 3);
        }
    }

    class BlackHole {
        constructor() { this.r = 0; this.life = 100; }
        update() { this.r = Math.min(50, this.r + 3); this.life--; }
        draw() {
            ctx.fillStyle = `rgba(0,0,0,${this.life/100})`;
            ctx.beginPath(); ctx.arc(RES_W/2, RES_H/2, this.r, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = "#f0f"; ctx.stroke();
        }
    }

    // --- DATA STREAM ---
    function init() {
        const ws = new WebSocket('wss://api-pub.bitfinex.com/ws/2');
        ws.onopen = () => {
            ws.send(JSON.stringify({ event: 'subscribe', channel: 'ticker', symbol: 'tBTCUSD' }));
            ws.send(JSON.stringify({ event: 'subscribe', channel: 'trades', symbol: 'tBTCUSD' }));
        };
        ws.onmessage = (msg) => {
            const data = JSON.parse(msg.data);
            if (!Array.isArray(data)) return;

            // Ticker (Price)
            if (data[1] && Array.isArray(data[1]) && data[1].length > 6) {
                const newPrice = data[1][6];
                if (targetPrice > 0) {
                    if (Math.floor(newPrice/100) !== Math.floor(targetPrice/100)) {
                        effects.push(new PulsarWave());
                        logEvent("$100 BARRIER BREACHED");
                    }
                    if (Math.floor(newPrice/500) !== Math.floor(targetPrice/500)) {
                        effects.push(new Spaceship());
                        logEvent("NAVIGATOR SCANNING SECTOR ($500)");
                    }
                    if (Math.floor(newPrice/1000) !== Math.floor(targetPrice/1000)) {
                        effects.push(new UFO());
                        logEvent("UFO DETECTED: $1000 MILESTONE");
                    }
                }
                targetPrice = newPrice;
                priceDisplay.innerText = `$${Math.floor(targetPrice).toLocaleString()}`;
            }

            // Trades (Black Hole)
            if (data[1] === "te") {
                const usd = Math.abs(data[2][2] * data[2][3]);
                if (usd > 10000) {
                    effects.push(new BlackHole());
                    logEvent(`VOID DETECTED: $${Math.floor(usd).toLocaleString()} WHALE`);
                }
            }
        };
    }

    function render(time) {
        ctx.fillStyle = "#010208"; ctx.fillRect(0, 0, RES_W, RES_H);
        currentPrice += (targetPrice - currentPrice) * 0.05;

        // 1. Comet Tail (History of movement)
        trail.push({x: RES_W/2, y: RES_H/2 + (Math.sin(time/500)*20)});
        if (trail.length > 40) trail.shift();
        
        ctx.lineWidth = 2;
        trail.forEach((p, i) => {
            ctx.strokeStyle = `rgba(94, 67, 243, ${i/trail.length})`;
            ctx.beginPath(); 
            ctx.arc(p.x - (trail.length - i)*2, p.y, i/2, 0, Math.PI*2); 
            ctx.stroke();
        });

        // 2. The Central Core
        const pulse = 25 + Math.sin(time/200)*5;
        const g = ctx.createRadialGradient(RES_W/2, RES_H/2, 2, RES_W/2, RES_H/2, pulse*1.5);
        g.addColorStop(0, "#fff"); g.addColorStop(0.4, "#5e43f3"); g.addColorStop(1, "transparent");
        ctx.fillStyle = g; ctx.fillRect(RES_W/2-50, RES_H/2-50, 100, 100);

        // 3. Update & Draw Effects
        effects = effects.filter(e => {
            e.update(); e.draw();
            return (e.life === undefined || e.life > 0) && (e.x === undefined || (e.x > -50 && e.x < RES_W+50));
        });

        requestAnimationFrame(render);
    }

    init(); render();
</script>
</body>
</html>
