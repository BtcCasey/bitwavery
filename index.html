<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BTC NAVIGATOR: FAIL-SAFE</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; }
        #ui-main { position: absolute; top: 25px; left: 25px; z-index: 100; background: rgba(0,0,0,0.9); padding: 18px; border: 2px solid #5e43f3; box-shadow: 0 0 15px #5e43f3; }
        #view-toggle { position: absolute; top: 25px; right: 25px; z-index: 100; background: #5e43f3; color: #fff; border: 4px solid #fff; padding: 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 10px; }
        #price { font-size: 18px; color: #fff; margin: 0; }
        #status { font-size: 7px; margin-top: 10px; color: #00ffcc; text-transform: uppercase; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<button id="view-toggle">GO TO RADAR</button>

<div id="ui-main">
    <div id="view-label" style="font-size: 8px; color: #5e43f3; margin-bottom: 8px;">SIGNAL: BTC/USD</div>
    <h1 id="price">SCANNING...</h1>
    <div id="status">INITIALIZING FAIL-SAFE...</div>
</div>

<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const statusDisplay = document.getElementById('status');
    const viewToggle = document.getElementById('view-toggle');
    const viewLabel = document.getElementById('view-label');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    let currentView = 'singularity';
    let btcPrice = 0, lastPrice = 0;
    let stars = Array.from({length: 60}, () => ({ x: Math.random()*RES_W, y: Math.random()*RES_H, v: 0.2+Math.random()*0.4 }));

    // --- FAIL-SAFE DATA POLLING ---
    async function fetchData() {
        try {
            // Using a standard public API that bypasses WebSocket blocks
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_vol=true');
            const data = await response.json();
            
            lastPrice = btcPrice;
            btcPrice = data.bitcoin.usd;
            
            priceDisplay.innerText = `$${Math.floor(btcPrice).toLocaleString()}`;
            statusDisplay.innerText = "SIGNAL STABLE (HTTP-TUNNEL)";
        } catch (e) {
            statusDisplay.innerText = "RETRIEVING DATA...";
        }
    }

    // Update every 5 seconds (standard for public APIs)
    setInterval(fetchData, 5000);
    fetchData();

    viewToggle.onclick = () => {
        currentView = currentView === 'singularity' ? 'radar' : 'singularity';
        viewToggle.innerText = currentView === 'singularity' ? 'GO TO RADAR' : 'GO TO SINGULARITY';
        viewLabel.innerText = currentView === 'singularity' ? 'CORE: SINGULARITY' : 'CORE: RADAR';
    };

    function render(time) {
        ctx.fillStyle = "#010208";
        ctx.fillRect(0, 0, RES_W, RES_H);

        // Stars
        ctx.fillStyle = "#444";
        stars.forEach(s => {
            s.x = (s.x - s.v + RES_W) % RES_W;
            ctx.fillRect(Math.floor(s.x), Math.floor(s.y), 1, 1);
        });

        const centerX = RES_W / 2;
        const centerY = RES_H / 2;

        if (currentView === 'singularity') {
            const pulse = 24 + Math.sin(time / 250) * 4;
            const grad = ctx.createRadialGradient(centerX, centerY, 2, centerX, centerY, pulse * 1.5);
            grad.addColorStop(0, "#fff");
            grad.addColorStop(0.3, btcPrice >= lastPrice ? "#00ff88" : "#ff4444");
            grad.addColorStop(1, "transparent");
            ctx.fillStyle = grad;
            ctx.fillRect(centerX - 80, centerY - 80, 160, 160);
        } else {
            // Simulated Radar View (since Order Books usually require WebSockets)
            // We use the price to seed a pixelated "Radar Grid"
            ctx.strokeStyle = "#5e43f3";
            ctx.lineWidth = 0.5;
            for(let i=0; i<5; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (time/20 + i*40) % 150, 0, Math.PI*2);
                ctx.stroke();
            }
            ctx.fillStyle = "#00ffcc";
            ctx.fillRect(centerX + Math.cos(time/1000)*60, centerY + Math.sin(time/1000)*60, 4, 4);
            ctx.fillText("SCANNING DEPTH...", 20, RES_H - 20);
        }

        requestAnimationFrame(render);
    }

    render();
</script>
</body>
</html>
