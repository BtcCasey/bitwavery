<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BTC NAVIGATOR: HYBRID BYPASS</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #010208; font-family: 'Press Start 2P', cursive; color: #fff; }
        #ui-main { position: absolute; top: 25px; left: 25px; z-index: 100; background: rgba(0,0,0,0.9); padding: 18px; border: 2px solid #5e43f3; }
        #view-toggle { position: absolute; top: 25px; right: 25px; z-index: 100; background: #5e43f3; color: #fff; border: 4px solid #fff; padding: 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 10px; }
        #price { font-size: 18px; color: #fff; margin: 0; }
        #status { font-size: 7px; margin-top: 10px; color: #00ffcc; text-transform: uppercase; }
        canvas { display: block; image-rendering: pixelated; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<button id="view-toggle">GO TO RADAR</button>

<div id="ui-main">
    <div id="view-label" style="font-size: 8px; color: #5e43f3; margin-bottom: 8px;">SIGNAL: AUTO-SCAN</div>
    <h1 id="price">SCANNING...</h1>
    <div id="status">BYPASSING FIREWALL...</div>
</div>

<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const statusDisplay = document.getElementById('status');
    const viewToggle = document.getElementById('view-toggle');

    const RES_W = 480; const RES_H = 270;
    canvas.width = RES_W; canvas.height = RES_H;

    let currentView = 'singularity';
    let btcPrice = 0, lastPrice = 0;
    let asks = [], bids = [];
    let stars = Array.from({length: 40}, () => ({ x: Math.random()*RES_W, y: Math.random()*RES_H, v: 0.3+Math.random()*0.5 }));

    // --- MULTI-GATEWAY DATA ENGINE ---
    function initHybridData() {
        // DOOR 1: BINANCE (Primary)
        const wsBinance = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        wsBinance.onmessage = (e) => {
            const data = JSON.parse(e.data);
            updatePrice(parseFloat(data.c), "BINANCE-WS");
        };

        // DOOR 2: COINBASE (Secondary - often bypasses proxies)
        const wsCoinbase = new WebSocket('wss://ws-feed.exchange.coinbase.com');
        wsCoinbase.onopen = () => wsCoinbase.send(JSON.stringify({type:"subscribe",channels:[{name:"ticker",product_ids:["BTC-USD"]}]}));
        wsCoinbase.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.price) updatePrice(parseFloat(data.price), "COINBASE-WS");
        };

        // DOOR 3: FAIL-SAFE POLLING (The "Unblockable" HTTP Tunnel)
        setInterval(async () => {
            if (Date.now() - lastUpdate > 10000) { // Only if WS fails for 10s
                try {
                    const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                    const data = await res.json();
                    updatePrice(parseFloat(data.price), "HTTP-TUNNEL");
                } catch(e) {}
            }
        }, 5000);
    }

    let lastUpdate = 0;
    function updatePrice(p, source) {
        lastUpdate = Date.now();
        lastPrice = btcPrice;
        btcPrice = p;
        priceDisplay.innerText = `$${Math.floor(btcPrice).toLocaleString()}`;
        statusDisplay.innerText = `SIGNAL: ${source}`;
        
        // Mock orderbook if live depth is blocked
        if (asks.length === 0) {
            for(let i=0; i<10; i++) {
                asks[i] = [btcPrice + (i*10), Math.random()*2];
                bids[i] = [btcPrice - (i*10), Math.random()*2];
            }
        }
    }

    viewToggle.onclick = () => {
        currentView = currentView === 'singularity' ? 'radar' : 'singularity';
        viewToggle.innerText = currentView === 'singularity' ? 'GO TO RADAR' : 'GO TO SINGULARITY';
    };

    function render(time) {
        ctx.fillStyle = "#010208";
        ctx.fillRect(0, 0, RES_W, RES_H);

        // Stars
        stars.forEach(s => {
            s.x = (s.x - s.v + RES_W) % RES_W;
            ctx.fillStyle = "#333";
            ctx.fillRect(Math.floor(s.x), Math.floor(s.y), 1, 1);
        });

        if (btcPrice === 0) {
            ctx.fillStyle = "#5e43f3";
            ctx.fillText("SEARCHING FOR DATA...", 140, 140);
        } else {
            const centerX = RES_W/2, centerY = RES_H/2;
            if (currentView === 'singularity') {
                const pulse = 25 + Math.sin(time/200)*5;
                const g = ctx.createRadialGradient(centerX, centerY, 2, centerX, centerY, pulse*1.8);
                g.addColorStop(0, "#fff");
                g.addColorStop(0.4, btcPrice >= lastPrice ? "#00ff88" : "#ff4444");
                g.addColorStop(1, "transparent");
                ctx.fillStyle = g;
                ctx.fillRect(centerX-100, centerY-100, 200, 200);
            } else {
                // RADAR VIEW
                asks.forEach((lvl, i) => {
                    ctx.fillStyle = "#ff4444";
                    ctx.fillRect(40 + (i*40), centerY - 40 - (Math.sin(time/500 + i)*10), 10, 5);
                });
                bids.forEach((lvl, i) => {
                    ctx.fillStyle = "#00ff88";
                    ctx.fillRect(40 + (i*40), centerY + 40 + (Math.cos(time/500 + i)*10), 10, 5);
                });
                ctx.strokeStyle = "rgba(94,67,243,0.3)";
                ctx.strokeRect(20, centerY-5, RES_W-40, 10);
            }
        }
        requestAnimationFrame(render);
    }

    initHybridData();
    render();
</script>
</body>
</html>
