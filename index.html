<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOVEREIGN: REALITY WARP</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Grenze+Gotisch:wght@400;700&family=IM+Fell+DW+Pica&display=swap" rel="stylesheet">
    <style>
        /* Theme Variables */
        :root {
            --bg: #010103; --accent: #00f7ff; --panel: rgba(10, 10, 20, 0.85);
            --font-main: 'Orbitron', sans-serif;
        }
        .theme-alchemy {
            --bg: #0a0806; --accent: #d4af37; --panel: rgba(25, 20, 15, 0.95);
            --font-main: 'IM Fell DW Pica', serif;
        }

        body { margin: 0; overflow: hidden; background: var(--bg); font-family: var(--font-main); color: #fff; transition: background 1s ease; }
        
        /* UI Layers */
        .glass-panel { 
            position: absolute; background: var(--panel); backdrop-filter: blur(15px); 
            border: 1px solid rgba(255,255,255,0.1); padding: 20px; z-index: 100;
        }
        #ui-top-left { top: 30px; left: 30px; border-left: 3px solid var(--accent); width: 280px; }
        #ui-bottom-log { bottom: 30px; left: 30px; width: 380px; height: 160px; overflow: hidden; display: flex; flex-direction: column-reverse; }

        /* Buttons */
        .ctrl-btn {
            position: absolute; z-index: 9999; background: rgba(0,0,0,0.5); color: #fff; 
            border: 1px solid var(--accent); padding: 10px 20px; cursor: pointer; 
            font-family: inherit; font-size: 10px; letter-spacing: 2px; transition: 0.3s;
        }
        #view-toggle { top: 30px; right: 30px; }
        #theme-toggle { top: 80px; right: 30px; border-color: #ff00ff; }
        #theme-toggle:hover { background: #ff00ff; color: #000; box-shadow: 0 0 20px #ff00ff; }

        #price { font-size: 32px; font-weight: 700; color: var(--accent); }
        .log-entry { font-size: 11px; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.03); color: #888; }
        
        canvas { display: block; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<button id="view-toggle" class="ctrl-btn">WARP TO BATTLEFIELD</button>
<button id="theme-toggle" class="ctrl-btn">WARP REALITY</button>

<div id="ui-top-left" class="glass-panel">
    <div id="feed-label" style="font-size: 8px; color: #555; margin-bottom: 5px;">COORDINATE STREAM</div>
    <div id="price">...</div>
</div>

<div id="ui-bottom-log" class="glass-panel"></div>
<canvas id="screen"></canvas>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const priceDisplay = document.getElementById('price');
    const logContainer = document.getElementById('ui-bottom-log');
    
    let currentTheme = 'space'; // 'space' or 'alchemy'
    let currentView = 'singularity';
    let btcPrice = 0, stars = [], ships = [], explosions = [];
    let rotation = 0, mouseX = 0, mouseY = 0;

    // --- LOGIC: Theme Toggle ---
    document.getElementById('theme-toggle').onclick = () => {
        currentTheme = (currentTheme === 'space') ? 'alchemy' : 'space';
        document.body.className = currentTheme === 'alchemy' ? 'theme-alchemy' : '';
        document.getElementById('feed-label').innerText = currentTheme === 'alchemy' ? 'ALCHEMY DIVINATION' : 'COORDINATE STREAM';
        document.getElementById('view-toggle').innerText = currentTheme === 'alchemy' ? 'GO TO THE WILDERNESS' : 'WARP TO BATTLEFIELD';
    };

    document.getElementById('view-toggle').onclick = () => {
        currentView = (currentView === 'singularity') ? 'battle' : 'singularity';
    };

    function resize() {
        const dpr = window.devicePixelRatio || 1;
        canvas.width = window.innerWidth * dpr;
        canvas.height = window.innerHeight * dpr;
        ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resize);
    window.addEventListener('mousemove', (e) => { mouseX = e.clientX; mouseY = e.clientY; });
    resize();

    async function init() {
        const candles = await fetch('https://api.exchange.coinbase.com/products/BTC-USD/candles?granularity=300').then(r => r.json());
        const prices = candles.map(c => c[4]).reverse();
        const minP = Math.min(...prices), maxP = Math.max(...prices);

        stars = prices.map((p, i) => ({
            p, angle: i * 0.14,
            baseDist: 60 + (i * 1.6),
            variance: ((p - minP) / (maxP - minP)) * 240,
            size: 2
        }));

        const ws = new WebSocket('wss://ws-feed.exchange.coinbase.com');
        ws.onopen = () => ws.send(JSON.stringify({ type: "subscribe", channels: ["ticker", "matches"], product_ids: ["BTC-USD"] }));
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if (data.type === 'ticker') {
                btcPrice = parseFloat(data.price);
                priceDisplay.innerText = (currentTheme === 'alchemy' ? 'â„¥ ' : '$') + btcPrice.toLocaleString();
            }
            if (data.type === 'match') {
                const div = document.createElement('div');
                div.className = 'log-entry';
                const verb = currentTheme === 'alchemy' ? 'Transmuted' : 'Traded';
                div.innerHTML = `> ${data.size} BTC ${verb} @ ${data.price}`;
                logContainer.prepend(div);
                if (logContainer.childNodes.length > 10) logContainer.lastChild.remove();
                
                if (currentView === 'battle') {
                    ships.push({ x: Math.random()*window.innerWidth, y: data.side==='buy'?window.innerHeight+20:-20, side: data.side, v: 4, size: 4 });
                }
            }
        };
    }

    function render() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
        ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);

        const cx = window.innerWidth / 2, cy = window.innerHeight / 2;
        rotation += 0.001;
        
        const accentColor = getComputedStyle(document.body).getPropertyValue('--accent');

        // Draw Spiral
        ctx.strokeStyle = currentTheme === 'alchemy' ? 'rgba(212, 175, 55, 0.1)' : 'rgba(0, 247, 255, 0.1)';
        ctx.beginPath();
        stars.forEach((s, i) => {
            const a = s.angle + rotation;
            const d = s.baseDist + s.variance;
            const x = cx + Math.cos(a) * d * 2;
            const y = cy + Math.sin(a) * d * 0.9;
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            
            ctx.fillStyle = accentColor;
            ctx.fillRect(x-1, y-1, s.size, s.size);
        });
        ctx.stroke();

        // Singularity / Pool
        if (currentView === 'singularity') {
            const pulse = 40 + Math.sin(Date.now()/500)*5;
            const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, pulse * 2);
            g.addColorStop(0, currentTheme === 'alchemy' ? 'rgba(74, 144, 226, 0.4)' : '#fff');
            g.addColorStop(1, 'transparent');
            ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cx, cy, pulse * 2, 0, Math.PI*2); ctx.fill();
        }

        requestAnimationFrame(render);
    }

    init(); render();
</script>
</body>
</html>
